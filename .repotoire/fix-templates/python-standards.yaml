# Python Standards Fix Templates
# ================================
# These templates provide fast, deterministic fixes for common Python issues.
# They are applied before LLM-based fixes, reducing API costs and latency.
#
# Template fields:
#   - name: Unique identifier (required)
#   - description: Human-readable explanation
#   - pattern: Regex or literal pattern to match (required)
#   - pattern_type: "regex" (default) or "literal"
#   - replacement: Code to replace matched pattern (required)
#                  Use $1, $2, ${1}, ${2} for capture groups
#   - confidence: HIGH, MEDIUM, or LOW (default: HIGH)
#   - fix_type: refactor, security, simplify, etc. (default: refactor)
#   - languages: List of applicable languages (default: [python])
#   - file_pattern: Glob pattern to filter files (optional)
#   - priority: 0-100, higher = checked first (default: 50)
#   - evidence: Documentation and best practices supporting the fix

templates:
  # ============================================================
  # None Comparisons (PEP 8)
  # ============================================================
  - name: "Use 'is None' comparison"
    description: "Replace '== None' with 'is None' per PEP 8"
    pattern: "==\\s*None"
    pattern_type: regex
    replacement: "is None"
    confidence: HIGH
    fix_type: refactor
    languages: [python]
    priority: 80
    evidence:
      documentation_refs:
        - "PEP 8: Comparisons to singletons like None should use 'is' or 'is not'"
      best_practices:
        - "Identity comparison is faster than equality comparison"
        - "None is a singleton, so 'is' is semantically correct"

  - name: "Use 'is not None' comparison"
    description: "Replace '!= None' with 'is not None' per PEP 8"
    pattern: "!=\\s*None"
    pattern_type: regex
    replacement: "is not None"
    confidence: HIGH
    fix_type: refactor
    languages: [python]
    priority: 80
    evidence:
      documentation_refs:
        - "PEP 8: Comparisons to singletons like None should use 'is' or 'is not'"
      best_practices:
        - "Identity comparison is faster and more idiomatic"

  # ============================================================
  # Boolean Comparisons (PEP 8)
  # ============================================================
  - name: "Remove '== True' comparison"
    description: "Remove redundant '== True' comparison"
    pattern: "==\\s*True"
    pattern_type: regex
    replacement: ""
    confidence: HIGH
    fix_type: simplify
    languages: [python]
    priority: 75
    evidence:
      documentation_refs:
        - "PEP 8: Don't compare boolean values to True or False using =="
      best_practices:
        - "Direct boolean evaluation is more readable"
        - "if x: is preferred over if x == True:"

  - name: "Remove '== False' comparison"
    description: "Replace '== False' with 'not'"
    pattern: "==\\s*False"
    pattern_type: regex
    replacement: ""
    confidence: MEDIUM
    fix_type: simplify
    languages: [python]
    priority: 70
    evidence:
      documentation_refs:
        - "PEP 8: Don't compare boolean values to True or False using =="
      best_practices:
        - "Use 'not x' instead of 'x == False'"

  # ============================================================
  # Deprecated Imports (Python 3.10+)
  # ============================================================
  - name: "Update deprecated collections.Mapping import"
    description: "Use collections.abc instead of collections for ABCs"
    pattern: "from collections import Mapping"
    pattern_type: literal
    replacement: "from collections.abc import Mapping"
    confidence: HIGH
    fix_type: refactor
    languages: [python]
    priority: 90
    evidence:
      documentation_refs:
        - "Python 3.3+ deprecation: Abstract base classes moved to collections.abc"
        - "Python 3.10: Direct imports from collections raise DeprecationWarning"
      best_practices:
        - "Future-proof code by using collections.abc"

  - name: "Update deprecated collections.MutableMapping import"
    description: "Use collections.abc instead of collections for ABCs"
    pattern: "from collections import MutableMapping"
    pattern_type: literal
    replacement: "from collections.abc import MutableMapping"
    confidence: HIGH
    fix_type: refactor
    languages: [python]
    priority: 90
    evidence:
      documentation_refs:
        - "Python 3.3+ deprecation: Abstract base classes moved to collections.abc"

  - name: "Update deprecated collections.Callable import"
    description: "Use collections.abc instead of collections for ABCs"
    pattern: "from collections import Callable"
    pattern_type: literal
    replacement: "from collections.abc import Callable"
    confidence: HIGH
    fix_type: refactor
    languages: [python]
    priority: 90
    evidence:
      documentation_refs:
        - "Python 3.3+ deprecation: Abstract base classes moved to collections.abc"
        - "Alternatively, use typing.Callable for type hints"

  - name: "Update deprecated collections.Iterable import"
    description: "Use collections.abc instead of collections for ABCs"
    pattern: "from collections import Iterable"
    pattern_type: literal
    replacement: "from collections.abc import Iterable"
    confidence: HIGH
    fix_type: refactor
    languages: [python]
    priority: 90
    evidence:
      documentation_refs:
        - "Python 3.3+ deprecation: Abstract base classes moved to collections.abc"

  # ============================================================
  # Exception Handling
  # ============================================================
  - name: "Replace bare Exception with RuntimeError"
    description: "Use specific exception types instead of bare Exception"
    pattern: "raise Exception\\((.*)\\)"
    pattern_type: regex
    replacement: "raise RuntimeError($1)"
    confidence: MEDIUM
    fix_type: refactor
    languages: [python]
    priority: 40
    evidence:
      documentation_refs:
        - "PEP 8: When raising exceptions, use specific exception classes"
      best_practices:
        - "RuntimeError is appropriate for most generic errors"
        - "Consider using ValueError, TypeError, or custom exceptions where appropriate"

  # ============================================================
  # String Formatting (Modern Python)
  # ============================================================
  - name: "Use f-string for simple format"
    description: "Convert simple .format() to f-string"
    pattern: '\"\\{\\}\"\.format\\(([^)]+)\\)'
    pattern_type: regex
    replacement: 'f"{$1}"'
    confidence: MEDIUM
    fix_type: refactor
    languages: [python]
    priority: 35
    evidence:
      documentation_refs:
        - "PEP 498: f-strings are the preferred string formatting method"
      best_practices:
        - "f-strings are more readable and faster than .format()"

  # ============================================================
  # Type Hints (Python 3.9+)
  # ============================================================
  - name: "Use builtin list instead of typing.List"
    description: "Python 3.9+ allows list[T] instead of List[T]"
    pattern: "from typing import List"
    pattern_type: literal
    replacement: "# List is available as builtin list[T] in Python 3.9+"
    confidence: MEDIUM
    fix_type: refactor
    languages: [python]
    priority: 30
    evidence:
      documentation_refs:
        - "PEP 585: Type Hinting Generics In Standard Collections"
      best_practices:
        - "Use list[int] instead of List[int] for Python 3.9+"

  - name: "Use builtin dict instead of typing.Dict"
    description: "Python 3.9+ allows dict[K, V] instead of Dict[K, V]"
    pattern: "from typing import Dict"
    pattern_type: literal
    replacement: "# Dict is available as builtin dict[K, V] in Python 3.9+"
    confidence: MEDIUM
    fix_type: refactor
    languages: [python]
    priority: 30
    evidence:
      documentation_refs:
        - "PEP 585: Type Hinting Generics In Standard Collections"
      best_practices:
        - "Use dict[str, int] instead of Dict[str, int] for Python 3.9+"

  # ============================================================
  # Security Patterns
  # ============================================================
  - name: "Remove debug print statements"
    description: "Remove print statements that may leak sensitive info"
    pattern: 'print\\(.*password.*\\)'
    pattern_type: regex
    replacement: "# REMOVED: print statement with sensitive data"
    confidence: HIGH
    fix_type: security
    languages: [python]
    priority: 95
    evidence:
      documentation_refs:
        - "OWASP: Sensitive Data Exposure prevention"
      best_practices:
        - "Never log or print passwords or sensitive credentials"
        - "Use logging with appropriate log levels instead"

  - name: "Replace assert with proper validation"
    description: "Don't use assert for data validation in production"
    pattern: "assert\\s+(.+?)\\s*,\\s*[\"'](.+?)[\"']"
    pattern_type: regex
    replacement: 'if not ($1):\n    raise ValueError("$2")'
    confidence: MEDIUM
    fix_type: security
    languages: [python]
    priority: 60
    evidence:
      documentation_refs:
        - "Python docs: assert statements can be disabled with -O flag"
        - "OWASP: Input Validation"
      best_practices:
        - "assert is for debugging, not for data validation"
        - "Use explicit validation with proper exception handling"
