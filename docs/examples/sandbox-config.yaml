# =============================================================================
# Repotoire Sandbox Configuration Example
# =============================================================================
#
# Copy this to your project root as .repotoirerc or repotoire.yaml
#
# Environment variables (set in .env or shell):
#   E2B_API_KEY=e2b_xxx_your_api_key
#   REPOTOIRE_TIMESCALE_URI=postgresql://user:pass@localhost:5432/repotoire_metrics
# =============================================================================

sandbox:
  # -------------------------------------------------------------------------
  # Execution Settings
  # -------------------------------------------------------------------------

  # Default timeout for all sandbox operations (seconds)
  # Min: 10, Max: 3600 (1 hour)
  # Default: 300 (5 minutes)
  timeout_seconds: 300

  # Memory limit in MB
  # Min: 256, Max: 16384 (16 GB)
  # Default: 1024 (1 GB)
  memory_mb: 1024

  # CPU core count
  # Min: 1, Max: 8
  # Default: 1
  cpu_count: 1

  # Custom E2B template (pre-installed tools for faster startup)
  # Options: null (default), "repotoire-analyzer", "repotoire-enterprise"
  # Default: null (uses E2B default Python template)
  template: "repotoire-analyzer"

  # -------------------------------------------------------------------------
  # Tool Execution Settings
  # -------------------------------------------------------------------------

  # Enable sandbox for analysis tools (ruff, bandit, mypy, etc.)
  # Default: true
  tools_enabled: true

  # Timeout specifically for tool execution
  # Default: 300
  tool_timeout_seconds: 300

  # Allow local subprocess fallback when E2B is unavailable
  # WARNING: Secrets may be exposed when running locally
  # Default: true (for development convenience)
  # Recommended for production: false
  fallback_local: false

  # -------------------------------------------------------------------------
  # Test Execution Settings
  # -------------------------------------------------------------------------

  # Timeout for test execution
  # Default: 300
  test_timeout_seconds: 300

  # Maximum allowed test timeout (prevents runaway tests)
  # Default: 1800 (30 minutes)
  test_max_timeout_seconds: 1800

  # Command to install dependencies before running tests
  # Set to "none" to skip installation
  # Default: "pip install -e ."
  test_install_command: "pip install -e ."

  # Test artifacts to download after execution
  # Default: ["coverage.xml", ".coverage", "junit.xml"]
  test_artifacts:
    - "coverage.xml"
    - ".coverage"
    - "junit.xml"
    - "htmlcov/"

  # Working directory inside sandbox
  # Default: "/code"
  working_dir: "/code"

  # -------------------------------------------------------------------------
  # Validation Settings
  # -------------------------------------------------------------------------

  # Run import validation (Level 2) - catches ImportError, NameError
  # Default: true
  run_import_check: true

  # Run type checking (Level 3) - runs mypy
  # Default: false (adds ~5-10s per validation)
  run_type_check: false

  # Treat type errors as blocking failures
  # Default: false (type errors reported as warnings)
  fail_on_type_errors: false

  # Validation timeout
  # Default: 30
  validation_timeout_seconds: 30

  # -------------------------------------------------------------------------
  # Skill Execution Settings (MCP skills)
  # -------------------------------------------------------------------------

  # Timeout for skill execution
  # Default: 300
  skill_timeout_seconds: 300

  # Memory limit for skill execution
  # Default: 1024
  skill_memory_mb: 1024

  # Maximum input context size (bytes)
  # Default: 10485760 (10 MB)
  skill_max_context_size: 10485760

  # Maximum output size (bytes)
  # Default: 10485760 (10 MB)
  skill_max_output_size: 10485760

  # Enable audit logging for skill executions
  # Default: true
  skill_audit_log: true

  # -------------------------------------------------------------------------
  # File Filtering (Security)
  # -------------------------------------------------------------------------

  # Additional patterns to exclude from sandbox uploads
  # These are in addition to the default exclusions:
  #   .env*, *.key, *.pem, credentials.json, .git/, etc.
  #
  # Pattern format: glob patterns (fnmatch)
  exclude_patterns:
    # Custom secrets
    - "internal_secrets/"
    - "**/api_keys.yaml"
    - "config/production.json"

    # Large files
    - "*.zip"
    - "*.tar.gz"
    - "data/**/*.csv"

    # Project-specific
    - "vendor/"
    - "third_party/"

  # Patterns for files to always INCLUDE (overrides exclusions)
  # Use sparingly - these bypass security filtering
  include_patterns: []

  # -------------------------------------------------------------------------
  # Metrics & Cost Tracking
  # -------------------------------------------------------------------------

  # Enable metrics collection (requires TimescaleDB)
  # Default: true if REPOTOIRE_TIMESCALE_URI is set
  track_metrics: true

  # Metrics retention in days
  # Default: 90
  metrics_retention_days: 90

  # -------------------------------------------------------------------------
  # Alerting
  # -------------------------------------------------------------------------

  # Cost threshold alert (USD per 24 hours)
  # Default: null (disabled)
  alert_cost_threshold: 10.0

  # Failure rate threshold (percentage per hour)
  # Default: null (disabled)
  alert_failure_rate_threshold: 10.0

  # Slow operation alert threshold (milliseconds)
  # Default: null (disabled)
  alert_slow_operation_ms: 30000


# =============================================================================
# Environment Variable Template
# =============================================================================
#
# Copy this to .env file:
#
# # E2B Sandbox (required for cloud sandbox)
# E2B_API_KEY=e2b_xxx_your_api_key_here
#
# # Optional: Custom template
# E2B_SANDBOX_TEMPLATE=repotoire-analyzer
#
# # Optional: Resource limits
# E2B_TIMEOUT_SECONDS=300
# E2B_MEMORY_MB=1024
# E2B_CPU_COUNT=1
#
# # Optional: Metrics database
# REPOTOIRE_TIMESCALE_URI=postgresql://repotoire:password@localhost:5432/repotoire_metrics
#
# # Optional: Alerting
# SLACK_WEBHOOK_URL=https://hooks.slack.com/services/xxx
# ALERT_TO_EMAILS=ops@company.com,team@company.com
# ALERT_COST_THRESHOLD=10.0
# ALERT_FAILURE_RATE_THRESHOLD=10.0
#
# =============================================================================
